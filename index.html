<!DOCTYPE html>
<html class="dark" lang="de">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>DHubBW - Dashboard</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&amp;display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&amp;display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              // DHBW Color Palette
              "dhbw-bg": "#121315",
              "dhbw-panel": "#1A1C1F",
              "dhbw-border": "#2A2D31",
              "dhbw-red": "#C8102E",
              "dhbw-red-muted": "#992029",
              "dhbw-text-primary": "#F2F2F5",
              "dhbw-text-secondary": "#A8ADB5",
              "dhbw-icon": "#5C6068",
              "dhbw-focus": "#26292D",
              "dhbw-success": "#3EA05B",
              "dhbw-warning": "#EBCB70",
              "dhbw-error": "#E03140",
            },
            fontFamily: {
              display: ["Inter", "Roboto", "sans-serif"],
            },
            borderRadius: {
              DEFAULT: "0.25rem",
              lg: "0.5rem",
              xl: "0.75rem",
              full: "9999px",
            },
          },
        },
      };
    </script>
    <style>
      .material-symbols-outlined {
        font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
      }
      body {
        min-height: max(884px, 100dvh);
      }
    </style>
  </head>
  <body class="bg-dhbw-bg font-display text-dhbw-text-primary">
    <!-- Navigation Header -->
    <header
      class="w-full bg-dhbw-panel border-b border-dhbw-border px-4 lg:px-6 h-16 flex items-center justify-between sticky top-0 z-50"
    >
      <div class="flex items-center gap-6">
        <!-- Mobile Menu Button (links vom Logo) -->
        <button
          id="mobile-menu-button"
          class="md:hidden text-dhbw-icon hover:text-dhbw-text-primary"
          aria-label="Menü öffnen"
          aria-controls="mobile-menu"
          aria-expanded="false"
          onclick="openMobileMenu()"
        >
          <span class="material-symbols-outlined">menu</span>
        </button>

        <!-- Update Logo (vereinheitlicht, größer) -->
        <img alt="DHubBW Logo" class="h-10 w-auto" src="UpdateLogo 1.png" />

        <!-- Navigation Menu -->
        <nav class="hidden md:flex items-center gap-4">
          <a
            class="nav-link text-sm font-medium text-dhbw-text-primary bg-dhbw-focus px-3 py-1.5 rounded-md"
            href="javascript:void(0)"
            onclick="showPage('dashboard')"
            >Dashboard</a
          >
          <a
            class="nav-link text-sm font-medium text-dhbw-text-secondary hover:text-dhbw-text-primary"
            href="javascript:void(0)"
            onclick="showPage('files')"
            >Dateien</a
          >
          <a
            class="nav-link text-sm font-medium text-dhbw-text-secondary hover:text-dhbw-text-primary"
            href="javascript:void(0)"
            onclick="showPage('calendar')"
            >Kalender</a
          >
          <a
            class="nav-link text-sm font-medium text-dhbw-text-secondary hover:text-dhbw-text-primary"
            href="javascript:void(0)"
            onclick="showPage('mensa')"
            >Mensa</a
          >
          <a
            class="nav-link text-sm font-medium text-dhbw-text-secondary hover:text-dhbw-text-primary"
            href="javascript:void(0)"
            onclick="showPage('polls')"
            >Umfragen</a
          >
          <a
            class="nav-link text-sm font-medium text-dhbw-text-secondary hover:text-dhbw-text-primary"
            href="javascript:void(0)"
            onclick="showPage('groups')"
            >Gruppen</a
          >
          <a
            class="nav-link text-sm font-medium text-dhbw-text-secondary hover:text-dhbw-text-primary"
            href="javascript:void(0)"
            onclick="showPage('qa')"
            >Q&A</a
          >
          <a
            class="nav-link text-sm font-medium text-dhbw-text-secondary hover:text-dhbw-text-primary"
            href="javascript:void(0)"
            onclick="showPage('admin')"
            >Admin</a
          >
          <a
            id="nav-group-admin"
            class="nav-link text-sm font-medium text-dhbw-text-secondary hover:text-dhbw-text-primary hidden"
            href="javascript:void(0)"
            onclick="showPage('group-admin')"
            >Group Admin</a
          >
          <a
            id="nav-system-admin"
            class="nav-link text-sm font-medium text-dhbw-text-secondary hover:text-dhbw-text-primary hidden"
            href="javascript:void(0)"
            onclick="showPage('system-admin')"
            >System Admin</a
          >
        </nav>
      </div>

      <div class="flex items-center gap-4">
        <div id="global-search" class="relative flex items-center">
          <input
            id="global-search-input"
            type="text"
            placeholder="Suchen..."
            class="hidden md:block w-56 mr-2 rounded-md border border-dhbw-border bg-dhbw-panel px-3 py-1.5 text-sm text-dhbw-text-primary placeholder:text-dhbw-text-secondary focus:outline-none focus:ring-1 focus:ring-dhbw-red"
          />
          <button
            id="global-search-toggle"
            class="text-dhbw-icon hover:text-dhbw-text-primary"
            aria-label="Suche öffnen / schließen"
          >
            <span class="material-symbols-outlined">search</span>
          </button>
        </div>
        <button class="text-dhbw-icon hover:text-dhbw-text-primary">
          <span class="material-symbols-outlined">notifications</span>
        </button>
        <!-- Profilbild aus calendar_and_deadlines -->
        <img
          alt="Profile Avatar"
          class="h-8 w-8 rounded-full object-cover cursor-pointer"
          src="https://lh3.googleusercontent.com/aida-public/AB6AXuChdHtZhjrNnRwmzFIbSthq5njGjE1VSLAcbteBNhzFiAKltSoGBsklJwTyH2cKMLmE4en-qwdid1WwUrBangAVrIA-mzk0cq77DYxuKUojXOZJIggoY4TnVgtLfAChxPVNYeBQckrDvL1gcowGtopbe7D9ZGUoXXXEc2DUwl6UlOUSBf3UQsATpXAFJRThDWtJo9nlzsak7VA1lp0kxkPfocs28_oIVesBXBNHeZBjSV0PzWB-8RC9epbbhd_tM0WKwD1R4Wzcsik"
          onclick="showPage('profile')"
        />
      </div>
    </header>

    <!-- Mobile Off-Canvas Navigation -->
    <div class="md:hidden">
      <!-- Backdrop -->
      <div
        id="mobile-menu-backdrop"
        class="fixed inset-0 bg-black/50 hidden z-40"
        onclick="closeMobileMenu()"
      ></div>
      <!-- Panel -->
      <aside
        id="mobile-menu"
        class="fixed left-0 top-0 h-full w-72 max-w-[80%] bg-dhbw-panel border-r border-dhbw-border z-50 transform -translate-x-full transition-transform duration-200 ease-out"
      >
        <div
          class="flex items-center justify-between h-16 px-4 border-b border-dhbw-border"
        >
          <div class="flex items-center gap-2">
            <img alt="DHubBW Logo" class="h-8 w-auto" src="UpdateLogo 1.png" />
            <span class="text-sm font-semibold">Menü</span>
          </div>
          <button
            class="text-dhbw-icon hover:text-dhbw-text-primary"
            aria-label="Menü schließen"
            onclick="closeMobileMenu()"
          >
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>
        <nav class="p-2">
          <a
            href="javascript:void(0)"
            class="block rounded-md px-3 py-2 text-sm hover:bg-dhbw-focus"
            onclick="showPage('dashboard'); closeMobileMenu();"
            >Dashboard</a
          >
          <a
            href="javascript:void(0)"
            class="block rounded-md px-3 py-2 text-sm hover:bg-dhbw-focus"
            onclick="showPage('files'); closeMobileMenu();"
            >Dateien</a
          >
          <a
            href="javascript:void(0)"
            class="block rounded-md px-3 py-2 text-sm hover:bg-dhbw-focus"
            onclick="showPage('calendar'); closeMobileMenu();"
            >Kalender</a
          >
          <a
            href="javascript:void(0)"
            class="block rounded-md px-3 py-2 text-sm hover:bg-dhbw-focus"
            onclick="showPage('mensa'); closeMobileMenu();"
            >Mensa</a
          >
          <a
            href="javascript:void(0)"
            class="block rounded-md px-3 py-2 text-sm hover:bg-dhbw-focus"
            onclick="showPage('polls'); closeMobileMenu();"
            >Umfragen</a
          >
          <a
            href="javascript:void(0)"
            class="block rounded-md px-3 py-2 text-sm hover:bg-dhbw-focus"
            onclick="showPage('groups'); closeMobileMenu();"
            >Gruppen</a
          >
          <a
            href="javascript:void(0)"
            class="block rounded-md px-3 py-2 text-sm hover:bg-dhbw-focus"
            onclick="showPage('qa'); closeMobileMenu();"
            >Q&amp;A</a
          >
          <a
            href="javascript:void(0)"
            class="block rounded-md px-3 py-2 text-sm hover:bg-dhbw-focus"
            onclick="showPage('admin'); closeMobileMenu();"
            >Admin</a
          >
          <a
            id="nav-group-admin-mobile"
            href="javascript:void(0)"
            class="hidden block rounded-md px-3 py-2 text-sm hover:bg-dhbw-focus"
            onclick="showPage('group-admin'); closeMobileMenu();"
            >Group Admin</a
          >
          <a
            id="nav-system-admin-mobile"
            href="javascript:void(0)"
            class="hidden block rounded-md px-3 py-2 text-sm hover:bg-dhbw-focus"
            onclick="showPage('system-admin'); closeMobileMenu();"
            >System Admin</a
          >
          <!-- <div class="mt-4 border-t border-dhbw-border pt-2">
            <a href="javascript:void(0)" class="flex items-center gap-3 rounded-md px-3 py-2 text-sm hover:bg-dhbw-focus" onclick="showPage('profile'); closeMobileMenu();">
              <img alt="Profile Avatar" class="h-6 w-6 rounded-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuChdHtZhjrNnRwmzFIbSthq5njGjE1VSLAcbteBNhzFiAKltSoGBsklJwTyH2cKMLmE4en-qwdid1WwUrBangAVrIA-mzk0cq77DYxuKUojXOZJIggoY4TnVgtLfAChxPVNYeBQckrDvL1gcowGtopbe7D9ZGUoXXXEc2DUwl6UlOUSBf3UQsATpXAFJRThDWtJo9nlzsak7VA1lp0kxkPfocs28_oIVesBXBNHeZBjSV0PzWB-8RC9epbbhd_tM0WKwD1R4Wzcsik" />
              <span>Mein Profil</span>
            </a>
          </div> -->
        </nav>
      </aside>
    </div>

    <!-- Content Container -->
    <div class="min-h-screen bg-dhbw-bg">
      <iframe
        id="content-frame"
        class="w-full h-[calc(100vh-4rem)] border-0"
        src="dashboard_overview/code.html"
      ></iframe>
    </div>

    <!-- Onboarding: Gruppe beitreten (Demo) -->
    <div
      id="onboard-backdrop"
      class="fixed inset-0 bg-black/50 hidden z-40"
    ></div>
    <div
      id="onboard-modal"
      class="fixed inset-0 z-50 hidden flex items-center justify-center p-4"
    >
      <div
        class="w-full max-w-xl rounded-lg border border-dhbw-border bg-dhbw-panel"
      >
        <div
          class="flex items-center justify-between p-4 border-b border-dhbw-border"
        >
          <h3 class="text-base font-bold">Gruppe beitreten</h3>
          <button
            class="text-dhbw-icon hover:text-dhbw-text-primary"
            onclick="closeOnboarding()"
          >
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>
        <div class="p-4 space-y-3">
          <label class="block text-sm text-dhbw-text-secondary"
            >Gruppe suchen</label
          >
          <input
            id="onboard-search"
            type="text"
            placeholder="z.B. TINF22B4"
            class="w-full rounded-md border border-dhbw-border bg-dhbw-bg px-3 py-2 text-sm text-dhbw-text-primary placeholder:text-dhbw-text-secondary focus:outline-none focus:ring-1 focus:ring-dhbw-red"
          />
          <div id="onboard-results" class="divide-y divide-dhbw-border">
            <!-- Ergebnisse per JS gefüllt -->
          </div>
        </div>
        <div
          class="p-4 border-t border-dhbw-border text-right text-xs text-dhbw-text-secondary"
        >
          Nur Demo – keine Speicherung.
        </div>
      </div>
    </div>

    <script>
      // Mobile menu controls
      function openMobileMenu() {
        const panel = document.getElementById("mobile-menu");
        const backdrop = document.getElementById("mobile-menu-backdrop");
        const btn = document.getElementById("mobile-menu-button");
        panel && panel.classList.remove("-translate-x-full");
        backdrop && backdrop.classList.remove("hidden");
        btn && btn.setAttribute("aria-expanded", "true");
        document.body.classList.add("overflow-hidden");
      }
      function closeMobileMenu() {
        const panel = document.getElementById("mobile-menu");
        const backdrop = document.getElementById("mobile-menu-backdrop");
        const btn = document.getElementById("mobile-menu-button");
        panel && panel.classList.add("-translate-x-full");
        backdrop && backdrop.classList.add("hidden");
        btn && btn.setAttribute("aria-expanded", "false");
        document.body.classList.remove("overflow-hidden");
      }
      // Close on ESC
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeMobileMenu();
      });
      function showPage(page) {
        // Remove active state from all nav links
        document.querySelectorAll(".nav-link").forEach((link) => {
          link.classList.remove(
            "text-dhbw-text-primary",
            "bg-dhbw-focus",
            "px-3",
            "py-1.5",
            "rounded-md"
          );
          link.classList.add("text-dhbw-text-secondary");
        });

        // Determine which nav link (if any) should get the active state
        let activeLink = null;
        if (typeof event !== "undefined" && event?.target) {
          // Only activate if the click originated from within a nav link
          activeLink = event.target.closest?.(".nav-link") || null;
        }
        // If triggered programmatically (e.g., on load) or from non-nav elements (e.g., profile image),
        // select the link that matches the requested page
        if (!activeLink) {
          activeLink = document.querySelector(
            `.nav-link[onclick="showPage('${page}')"]`
          );
        }
        if (activeLink) {
          activeLink.classList.remove("text-dhbw-text-secondary");
          activeLink.classList.add(
            "text-dhbw-text-primary",
            "bg-dhbw-focus",
            "px-3",
            "py-1.5",
            "rounded-md"
          );
        }

        // Load the appropriate page
        const iframe = document.getElementById("content-frame");
        switch (page) {
          case "dashboard":
            iframe.src = "dashboard_overview/code.html";
            break;
          case "files":
            iframe.src = "files_management/code.html";
            break;
          case "calendar":
            iframe.src = "calendar_and_deadlines/code.html";
            break;
          case "mensa":
            iframe.src = "mensa-detailansicht/code.html";
            break;
          case "polls":
            iframe.src = "polls_management/code.html";
            break;
          case "groups":
            iframe.src = "groups_directory/code.html";
            break;
          case "qa":
            iframe.src = "frage_&_antwort_plattform/code.html";
            break;
          case "admin":
            iframe.src = "admin/stuv_announcements/code.html";
            break;
          case "group-admin":
            iframe.src = "groups_directory/group_admin/code.html";
            break;
          case "system-admin":
            iframe.src = "admin/system_admin/code.html";
            break;
          case "profile":
            iframe.src = "profilseite/code.html";
            break;
        }
      }

      // Initialize with dashboard page
      function updateRoleNav() {
        const role = sessionStorage.getItem("DHBW_ROLE") || "user";
        const entries = [
          document.getElementById("nav-group-admin"),
          document.getElementById("nav-group-admin-mobile"),
        ];
        const entriesSys = [
          document.getElementById("nav-system-admin"),
          document.getElementById("nav-system-admin-mobile"),
        ];
        // reset
        entries.forEach((el) => el?.classList.add("hidden"));
        entriesSys.forEach((el) => el?.classList.add("hidden"));
        // apply
        if (role === "group-admin" || role === "system-admin")
          entries.forEach((el) => el?.classList.remove("hidden"));
        if (role === "system-admin")
          entriesSys.forEach((el) => el?.classList.remove("hidden"));
      }
      document.addEventListener("DOMContentLoaded", function () {
        showPage("dashboard");
        updateRoleNav();

        // Onboarding (once per session)
        if (!sessionStorage.getItem("DHBW_ONBOARD_SHOWN")) {
          openOnboarding();
          sessionStorage.setItem("DHBW_ONBOARD_SHOWN", "1");
        }
      });

      // Onboarding modal logic
      const GROUPS = ["TINF22B4", "TINF22B3", "WWI22A", "WWI22B", "AI23A"];
      function renderOnboardResults(filter = "") {
        const wrap = document.getElementById("onboard-results");
        const q = filter.trim().toLowerCase();
        const items = GROUPS.filter((g) => g.toLowerCase().includes(q));
        wrap.innerHTML =
          items
            .map(
              (g) => `
          <div class="flex items-center justify-between py-3 px-1">
            <div>
              <p class="text-sm text-dhbw-text-primary">${g}</p>
              <p class="text-xs text-dhbw-text-secondary">Mitglieder: ${
                20 + Math.floor(Math.random() * 20)
              }</p>
            </div>
            <button class="text-xs px-2 py-1 rounded-md bg-dhbw-red text-white" onclick="alert('Zugang zu ${g} angefragt (Demo)')">Zugang anfragen</button>
          </div>
        `
            )
            .join("") ||
          '<p class="text-xs text-dhbw-text-secondary py-3">Keine Treffer</p>';
      }
      function openOnboarding() {
        document.getElementById("onboard-backdrop")?.classList.remove("hidden");
        document.getElementById("onboard-modal")?.classList.remove("hidden");
        renderOnboardResults("");
        const input = document.getElementById("onboard-search");
        input.value = "";
        input.focus();
        input.oninput = () => renderOnboardResults(input.value);
        document.addEventListener("keydown", escClose);
        document.getElementById("onboard-backdrop").onclick = closeOnboarding;
      }
      function closeOnboarding() {
        document.getElementById("onboard-backdrop")?.classList.add("hidden");
        document.getElementById("onboard-modal")?.classList.add("hidden");
        document.removeEventListener("keydown", escClose);
      }
      function escClose(e) {
        if (e.key === "Escape") closeOnboarding();
      }

      // React to role changes from profile (sessionStorage updates in iframe)
      window.addEventListener("storage", (e) => {
        if (e.key === "DHBW_ROLE") updateRoleNav();
      });

      // Global Search Toggle Logic
      (function initGlobalSearch() {
        const toggleBtn = document.getElementById("global-search-toggle");
        const input = document.getElementById("global-search-input");
        let open = false;
        function openSearch() {
          if (open) return;
          open = true;
          input.classList.remove("hidden");
          input.focus();
          toggleBtn.classList.add("text-dhbw-text-primary");
        }
        function closeSearch() {
          if (!open) return;
          open = false;
          input.classList.add("hidden");
          input.value = "";
          toggleBtn.classList.remove("text-dhbw-text-primary");
        }
        toggleBtn.addEventListener("click", () =>
          open ? closeSearch() : openSearch()
        );
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") closeSearch();
        });
        document.addEventListener("mousedown", (e) => {
          if (open && !e.target.closest("#global-search")) closeSearch();
        });
      })();
    </script>
  </body>
</html>
